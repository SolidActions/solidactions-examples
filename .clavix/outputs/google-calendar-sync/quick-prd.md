# Google Calendar Sync (SolidActions) - Quick PRD

Port the existing Kestra-based cal_syncer to SolidActions as a generic bidirectional Google Calendar sync. The system runs every 15 minutes on a cron schedule, fetching events from two configurable Google Calendars and creating prefixed copies on the opposite calendar (e.g. `[Pattern] Meeting`). It detects changes via event signature comparison (`summary|start|end|location|transparency|hangoutLink`), updates synced copies when signatures change, and automatically deletes orphaned events when the primary event is removed. Duplicate filtering prevents re-syncing by checking for sync metadata tags in descriptions, target calendar presence in attendees, and existing sheet records. All Google Calendar and spreadsheet writes are atomic per-event to prevent orphaned records on interruption. Telegram notifications fire on workflow failure.

Built on SolidActions SDK with googleapis in TypeScript (ES2022/NodeNext). SolidActions manages OAuth token lifecycle — exposes `GCAL_OAUTH_TOKEN` (Calendar API) and `GSHEET_OAUTH_TOKEN` (Sheets API) as auto-refreshing env vars, replacing the Kestra service account approach. Google Sheets tracks all synced events in a `synced_events` sheet tab with signature-based change detection, eliminating the PostgreSQL dependency. Four workflows: a scheduled `sync-google-calendars` (15-min cron), a webhook variant `sync-google-calendars-webhook` (same file, wait mode — enables on-demand sync via HTTP for testing), a webhook-triggered `init-database` for idempotent sheet setup, and a webhook-triggered `test-sync` (wait mode, 300s timeout) that runs end-to-end integration tests — creates events with varied fields, triggers sync via `fetch(SYNC_WEBHOOK_URL)`, verifies creates, updates individual signature fields, verifies updates, tests all 3 duplicate filters, deletes events and verifies orphan cleanup, and returns a structured pass/fail report. Everything is configurable via env vars: `CALENDAR_A_ID`, `CALENDAR_B_ID`, `CALENDAR_A_PREFIX`, `CALENDAR_B_PREFIX`, `SPREADSHEET_ID`, `MAX_EVENTS`, `DAYS_AHEAD`, plus Telegram credentials.

Out of scope: no UI/dashboard, no multi-user support, no calendar discovery/selection UI, no historical backfill beyond the sync window. Dev safety: `MAX_EVENTS` env var (default 2500, set to 20 in dev) caps event fetches to prevent accidental duplication during testing. Only one sync execution should run at a time to prevent sheet race conditions.

---

*Generated with Clavix Planning Mode*
*Updated: 2026-02-20 (added Integration Test Workflow)*
